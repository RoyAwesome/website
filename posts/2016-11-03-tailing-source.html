

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="../css/all.css">
        <link rel="stylesheet" type="text/css" href="../css/main.css">
        <link rel="stylesheet" type="text/css" href="../css/darkstrap.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <title>A better chat client for Source games</title>
    </head>
    <body>
        <!-- Fixed navbar -->
        <nav class="navbar navbar-default navbar-fixed-top">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="http://store.steampowered.com/app/17740/">Empires<span><img class="insignia" align="middle" src="../img/IMP_insignia.png" /></span></a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
              <ul class="nav navbar-nav">
              	<li><a class="return-home" href="../index.html"><span class="glyphicon glyphicon-home"></span>Home</a></li>
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                  	Meet players
                  	<span class="caret"></span></a>
                  <ul class="dropdown-menu">
                		<li><a href="http://forums.empiresmod.com" target="_blank">Chat on the forums</a></li>
                		<li><a href="http://steamcharts.com/app/17740" target="_blank">Current playercount</a></li>
                		<li><a href="http://steamcommunity.com/app/17740" target="_blank">Steam Community Hub</a></li>
                	</ul>
                </li>
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                  	Learn
                  	<span class="caret"></span></a>
                  <ul class="dropdown-menu">
                    <li class="dropdown-header">Text Tutorials</li>
                    <li><a href="../docs/quickstart/quick_start.html" target="_blank">Quick-Start Guide</a></li>
                    <li><a href="../docs/index.htm" target="_blank">Manual</a></li>
                    <li role="separator" class="divider"></li>
                    <li class="dropdown-header">Advanced topics</li>
                    <li><a href="https://wiki.empiresmod.com/Main_Page" target="_blank">Wiki</a></li>
                    <li><a href="https://wiki.empiresmod.com/Dedicated_Server_Setup" target="_blank">Server setup</a></li>
                  </ul>
                </li>
                <li class="dropdown">
               	  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
               	  	Developers
               	  	<span class="caret"></span></a>
                  <ul class="dropdown-menu">
                    <li><a href="../static-html/team.html">Meet the team</a></li>
                  	<li><a href="../static-md/join.html">Join us</a></li>
                  	<li><a href="../archive.html">Developer blog</a></li>
                  	<li><a href="../financials.html">Financial reports</a></li>
                	</ul>
              	</li>
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Help<span class="caret"></span></a>
                  <ul class="dropdown-menu">
                    <li class="dropdown-header">Stuck?</li>
                    <li><a href="https://forums.empiresmod.com/index.php?forums/support.34/" target="_blank">Get community support</a></li>
                    <li><a href="https://forums.empiresmod.com/index.php?forums/bug-reports.6/" target="_blank">Report a bug</a></li>
                    <li><a href="https://github.com/EmpiresCommunity/website/issues/new" target="_blank">Report a website issue</a></li>
                  </ul>
                </li>
              	<li><a href="mailto:tama@empiresmod.com?body=Dear Empiresmod Developers,"><span class="glyphicon glyphicon-envelope"></span>Contact us</a></li>
              	<li><a href="https://www.patreon.com/Empires" target="_blank"><img class="patreon_icon" align="middle" src="../img/patreon_logo.png" />Support us</a></li>
              </ul>
            </div><!--/.nav-collapse -->
          </div>
        </nav>
        <div class="spacer">&nbsp;</div>
        <div class="container post">
    <h1>A better chat client for Source games</h1>
    <p class="author">By Tama on November  3, 2016</p>

    <p>By default, there’s just a tiny little chat window that only shows up when you type T or Y to talk, has limited scrolling and no filtering options. Today I used some unix tools to build myself a proper chat client to use while playing Empires. It should work for any Source engine game, and gives you a fullscreen, scrollable window to put on a second screen, that gives you a notification popup when your name is mentioned in chat.</p>
<p><img src="http://i.imgur.com/lAXbG7s.gif" title="The chat client (early version)" /></p>
<h1 id="how-it-works">How it works</h1>
<p>If -condebug is passed, Empires will output the console’s output to the empires/console.log file. (To add -condebug, right click Empires in steam, click “Properties” and then “Set Launch Options”) By ‘tailing’ this file, we can extract the chat and any mentions of us.</p>
<p>To run emp_chat, copy the script below into a directory in your $PATH, and run it from the terminal while Empires is running. The first grep will select and print from the real beginning of a chat line (some of them begin with some garbage, hence the -o to suppress that), and if that doesn’t match, ignore the rest of the loop. Then we do a similar grep using whatever parameters were passed to see if we got mentioned. If so, split up the line into sender name and message, so that notify-send can be invoked, which gives me a nice popup on the bottom of my screen with the message.</p>
<pre><code>#!/bin/bash

# Outputs the chat lines from a source game's console.log file
# If given parameters, these are passed to grep; if it matches, 
# you get a notification of the message

LOGFILE=~/.steam/steam/steamapps/common/Empires/empires/console.log
tail -f $LOGFILE | (while read line; do 
	echo $line | grep &quot;([^)]*)\ [^:]*:\ .*&quot; -o; if [ $? -eq 1 ]; then continue; fi; 
	if (( $# == 0 )); then continue; fi;
	echo $line | grep $@ &gt; /dev/null; 
	if [ $? -eq 0 ]; then 
		NAME=`echo $line | sed 's/.*([^)]*)\ \([^:]*\):.*/\1/'`; 
		MSG=`echo $line | sed 's/.*([^)]*)\ [^:]*:\ \(.*\)/\1/'`;
		notify-send &quot;$NAME&quot; &quot;$MSG&quot; --icon=dialog-information; 
	fi;
done)</code></pre>
<h1 id="tmux-for-scrolling-and-panes">Tmux for scrolling and panes</h1>
<p>In the first screenshot, you could see some numbers and names at the bottom of the screen. This is because I’m using tmux to allow me to scroll through any terminal output, such as the output of emp_chat, and allows you to add terminal windows and panes without opening another terminal window. To scroll, press “Cntrl-B [” and then use shift j-k to move up and down. You can also use ? or / to search forwards and backwords, or read the <a href="https://wiki.archlinux.org/index.php/Tmux">tmux manual</a>.</p>
<p>Whenever there is new output on another window, it highlights in red. That means you could also just open a bunch of windows, each with a command running like:</p>
<pre><code>tail -f ~/.steam/steam/steamapps/common/Empires/empires/console.log | grep &quot;ref\|rax&quot;</code></pre>
<p>And name each one - the red highlighting will tell you to switch to that pane, and it will only list all the requests for refs and raxes.</p>
<h1 id="expanding-on-this">Expanding on this</h1>
<p>There’s a lot of useful information about what is happening in the game in the console.log file; below is an extract from one, showing a mapswitch. Currently, I am just looking at chat, but you could also feasibly create a fullscreen map with some extra information drawn on top, completely outside of the game.</p>
<p><img src="http://i.imgur.com/qU47KGt.gif" title="An example console log" /></p>
<p>The script above is hosted in <a href="https://github.com/TamaHobbit/dotfiles">my dotfiles repository</a>, so you can comment there if you have useful additions, or <a href="mailto:tama@empiresmod.com">email tama@empiresmod.com</a> if you have something way cooler I should be using.</p>
</div>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="../js/main.js" type="text/javascript"> </script>
    </body>
</html>
